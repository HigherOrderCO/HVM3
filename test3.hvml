data A {
  #B{a b}
  #C{c}
}

// @main = &0{#B{&1{1 2} 3} #C{&1{4 5}}}
// @main = &0{#B{&1{1 2} &0{3 4}} #C{&0{5 6}}}
// @main = &0{#B{&1{#B{&1{1 2} &2{* 4}} #C{&3{1 2}}} #C{&4{7 *}}} #C{*}}
// @main = &0{

// @main = Î»x ~x {
//   #B{a b}: &0{3 4}
//   #C{a}:   &0{5 6}
// }

// &R{x,&L{y0,y1}}
// ----------------------- SUP-SUP-Y (if R>L)
// !&R{x0,x1} = x;
// &L{&R{x0,y0},&R{x1,y1}}
// @main = &1{1 #B{&0{1 2} 3}}
// &1{1 &0{#B{1 3} #B{2 3}}}
// R=1 L=0 y0=#B{1 3} y1=#B{2 3} x=1
// &0{&1{1 #B{1 3}} &1{1 #B{2 3}}}


data Tree { #Leaf #Node{lft rgt} }

@all(s l) = ~s {
  0:
    #Leaf
  p:
    !&0{p p0}=p
    !&0{p p1}=p
    !&0{l l0}=l
    !&0{l l1}=l
    !&0{l l2}=l
    ! lL = (+ (* l1 2) 0)
    ! lR = (+ (* l2 2) 1)
    @SUP(l0 #Leaf #Node{ @all(p0 lL) @all(p1 lR) })
}

// @main = @all(3 1)

// @main = &1{#Leaf{} #Node{&2{#Leaf{} #Node{&4{#Leaf{} #Node{&8{#Leaf{} #Node{#Leaf{} #Leaf{}}} &9{#Leaf{} #Node{#Leaf{} #Leaf{}}}}} &5{#Leaf{} #Node{&10{#Leaf{} #Node{#Leaf{} #Leaf{}}} &11{#Leaf{} #Node{#Leaf{} #Leaf{}}}}}}} &3{#Leaf{} #Node{&6{#Leaf{} #Node{&12{#Leaf{} #Node{#Leaf{} #Leaf{}}} &13{#Leaf{} #Node{#Leaf{} #Leaf{}}}}} &7{#Leaf{} #Node{&14{#Leaf{} #Node{#Leaf{} #Leaf{}}} &15{#Leaf{} #Node{#Leaf{} #Leaf{}}}}}}}}}
//
@main = &1{#Leaf{} #Node{&2{#Leaf{} #Node{&4{#Leaf{} #Node{&8{#Leaf{}
#Node{#Leaf{} #Leaf{}}} &9{#Leaf{} #Node{#Leaf{} #Leaf{}}}}} &5{#Leaf{}
#Node{&10{#Leaf{} #Node{#Leaf{} #Leaf{}}} &11{#Leaf{} #Node{#Leaf{}
#Leaf{}}}}}}} &3{#Leaf{} #Node{#Leaf #Leaf}}}}

@main = &1{#Leaf{} #Node{&2{#Leaf{} #Node{&4{#Leaf{} #Node{&8{#Leaf{}
#Node{#Leaf{} #Leaf{}}} &9{#Leaf{} #Node{#Leaf{} #Leaf{}}}}} &5{#Leaf{}
#Node{&10{#Leaf{} #Node{#Leaf{} #Leaf{}}} &11{#Leaf{} #Node{#Leaf{}
#Leaf{}}}}}}} &10{#Leaf{} #Node{#Leaf #Leaf}}}}
//

